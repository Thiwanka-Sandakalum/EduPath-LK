openapi: 3.0.3
info:
  title: Educational Programs API
  description: API for managing educational institutions and their study programs with full CRUD operations, search, and filtering capabilities
  version: 1.0.0

tags:
  - name: Institutions
    description: Institution management operations
  - name: Programs
    description: Program management operations
  - name: Search
    description: Search and filtering operations

paths:
  /institutions:
    get:
      tags:
        - Institutions
      summary: List all institutions
      description: Retrieve a paginated list of institutions with optional filtering
      operationId: listInstitutions
      parameters:
        - name: page
          in: query
          description: Page number
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: limit
          in: query
          description: Items per page
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
        - name: country
          in: query
          description: Filter by country
          schema:
            type: string
        - name: type
          in: query
          description: Filter by institution type
          schema:
            type: string
        - name: sort
          in: query
          description: Sort field and direction (e.g., name:asc, confidence_score:desc)
          schema:
            type: string
            default: name:asc
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Institution"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalError"

    post:
      tags:
        - Institutions
      summary: Create a new institution
      description: Add a new institution to the database
      operationId: createInstitution
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/InstitutionCreate"
      responses:
        "201":
          description: Institution created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Institution"
        "400":
          $ref: "#/components/responses/BadRequest"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalError"

  /institutions/{institutionId}:
    get:
      tags:
        - Institutions
      summary: Get institution by ID
      description: Retrieve a specific institution by its unique identifier
      operationId: getInstitution
      parameters:
        - name: institutionId
          in: path
          required: true
          description: Institution ID
          schema:
            type: string
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Institution"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

    put:
      tags:
        - Institutions
      summary: Update institution
      description: Update an existing institution (full update)
      operationId: updateInstitution
      parameters:
        - name: institutionId
          in: path
          required: true
          description: Institution ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/InstitutionUpdate"
      responses:
        "200":
          description: Institution updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Institution"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

    patch:
      tags:
        - Institutions
      summary: Partially update institution
      description: Update specific fields of an institution
      operationId: patchInstitution
      parameters:
        - name: institutionId
          in: path
          required: true
          description: Institution ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/InstitutionPatch"
      responses:
        "200":
          description: Institution updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Institution"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

    delete:
      tags:
        - Institutions
      summary: Delete institution
      description: Remove an institution from the database
      operationId: deleteInstitution
      parameters:
        - name: institutionId
          in: path
          required: true
          description: Institution ID
          schema:
            type: string
      responses:
        "204":
          description: Institution deleted successfully
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          description: Cannot delete institution with associated programs
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          $ref: "#/components/responses/InternalError"

  /institutions/{institutionId}/programs:
    get:
      tags:
        - Programs
      summary: List programs by institution
      description: Retrieve all programs offered by a specific institution
      operationId: listInstitutionPrograms
      parameters:
        - name: institutionId
          in: path
          required: true
          description: Institution ID
          schema:
            type: string
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
        - name: level
          in: query
          description: Filter by academic level
          schema:
            type: string
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Program"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /programs:
    get:
      tags:
        - Programs
      summary: List all programs
      description: Retrieve a paginated list of all programs with advanced filtering
      operationId: listPrograms
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
        - name: institution_id
          in: query
          description: Filter by institution ID
          schema:
            type: string
        - name: name
          in: query
          description: Filter by program name (partial match)
          schema:
            type: string
        - name: level
          in: query
          description: Filter by academic level (e.g., Undergraduate, Postgraduate)
          schema:
            type: string
        - name: delivery_mode
          in: query
          description: Filter by delivery mode (e.g., Full-time, Part-time, Online)
          schema:
            type: string
        - name: specializations
          in: query
          description: Filter by specialization(s) (e.g., AI, Data Science). Accepts a single value or an array.
          schema:
            oneOf:
              - type: string
              - type: array
                items:
                  type: string
        - name: duration
          in: query
          description: Filter by duration (partial match, if stored as a simple value)
          schema:
            type: string
        - name: eligibility
          in: query
          description: Filter by eligibility (partial match, if stored as a simple value)
          schema:
            type: string
        - name: sort
          in: query
          schema:
            type: string
            default: name:asc
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Program"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalError"

    post:
      tags:
        - Programs
      summary: Create a new program
      description: Add a new program to the database
      operationId: createProgram
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProgramCreate"
      responses:
        "201":
          description: Program created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Program"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalError"

  /programs/distinct:
    get:
      tags:
        - Programs
      summary: Get distinct values for a program field
      description: Returns all unique values for a specified field in the programs collection. Useful for dynamic filter options in UIs.
      operationId: getProgramDistinctValues
      parameters:
        - name: field
          in: query
          required: true
          description: The field name to get distinct values for (e.g., level, delivery_mode, specializations, etc.)
          schema:
            type: string
            enum:
              [
                institution_id,
                name,
                program_code,
                description,
                level,
                duration,
                delivery_mode,
                fees,
                eligibility,
                specializations,
              ]
      responses:
        "200":
          description: Distinct values returned successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  values:
                    type: array
                    items:
                      type: string
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalError"

  /programs/{programId}:
    get:
      tags:
        - Programs
      summary: Get program by ID
      description: Retrieve a specific program by its unique identifier
      operationId: getProgram
      parameters:
        - name: programId
          in: path
          required: true
          description: Program ID
          schema:
            type: string
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Program"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

    put:
      tags:
        - Programs
      summary: Update program
      description: Update an existing program (full update)
      operationId: updateProgram
      parameters:
        - name: programId
          in: path
          required: true
          description: Program ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProgramUpdate"
      responses:
        "200":
          description: Program updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Program"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

    patch:
      tags:
        - Programs
      summary: Partially update program
      description: Update specific fields of a program
      operationId: patchProgram
      parameters:
        - name: programId
          in: path
          required: true
          description: Program ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProgramPatch"
      responses:
        "200":
          description: Program updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Program"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

    delete:
      tags:
        - Programs
      summary: Delete program
      description: Remove a program from the database
      operationId: deleteProgram
      parameters:
        - name: programId
          in: path
          required: true
          description: Program ID
          schema:
            type: string
      responses:
        "204":
          description: Program deleted successfully
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /search:
    get:
      tags:
        - Search
      summary: Search institutions and programs
      description: Full-text search across institutions and programs
      operationId: search
      parameters:
        - name: q
          in: query
          required: true
          description: Search query
          schema:
            type: string
        - name: type
          in: query
          description: Search scope (institutions, programs, or both)
          schema:
            type: string
            enum: [institutions, programs, all]
            default: all
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  institutions:
                    type: array
                    items:
                      $ref: "#/components/schemas/Institution"
                  programs:
                    type: array
                    items:
                      $ref: "#/components/schemas/Program"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalError"

components:
  schemas:
    Institution:
      type: object
      required:
        - _id
        - name
        - confidence_score
        - created_at
        - updated_at
      properties:
        _id:
          type: string
          description: MongoDB ObjectId
          example: "507f1f77bcf86cd799439011"
        name:
          type: string
          description: Official institution name
          example: "University of Colombo"
        institution_code:
          type: string
          description: Unique identifier
          example: "UOC"
        image_url:
          type: string
          format: uri
          description: Public image URL for the institution (hero/logo)
          example: "https://images.unsplash.com/photo-1523050854058-8df90110c9f1?q=80&w=2000&auto=format&fit=crop"
        description:
          type: string
          description: Institution overview
        type:
          type: array
          items:
            type: string
          description: Institution types (e.g., University, College, Institute)
          example: ["University", "Public"]
        country:
          type: string
          default: "Sri Lanka"
          description: Country
        website:
          type: string
          format: uri
          description: Website URL
          example: "https://www.cmb.ac.lk"
        recognition:
          type: object
          description: Accreditation and recognition details
          additionalProperties: true
        contact_info:
          type: object
          description: Contact details
          properties:
            email:
              type: string
              format: email
            phone:
              type: string
            address:
              type: string
          additionalProperties: true
        confidence_score:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0
          description: Confidence score (0-1)
          example: 0.95
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    InstitutionCreate:
      type: object
      required:
        - name
        - confidence_score
      properties:
        name:
          type: string
        institution_code:
          type: string
        image_url:
          type: string
          format: uri
        description:
          type: string
        type:
          type: array
          items:
            type: string
        country:
          type: string
          default: "Sri Lanka"
        website:
          type: string
          format: uri
        recognition:
          type: object
          additionalProperties: true
        contact_info:
          type: object
          additionalProperties: true
        confidence_score:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0

    InstitutionUpdate:
      type: object
      required:
        - name
        - confidence_score
      properties:
        name:
          type: string
        institution_code:
          type: string
        image_url:
          type: string
          format: uri
        description:
          type: string
        type:
          type: array
          items:
            type: string
        country:
          type: string
        website:
          type: string
          format: uri
        recognition:
          type: object
          additionalProperties: true
        contact_info:
          type: object
          additionalProperties: true
        confidence_score:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0

    InstitutionPatch:
      type: object
      properties:
        name:
          type: string
        institution_code:
          type: string
        image_url:
          type: string
          format: uri
        description:
          type: string
        type:
          type: array
          items:
            type: string
        country:
          type: string
        website:
          type: string
          format: uri
        recognition:
          type: object
          additionalProperties: true
        contact_info:
          type: object
          additionalProperties: true
        confidence_score:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0

    Program:
      type: object
      required:
        - _id
        - institution_id
        - name
        - confidence_score
        - created_at
        - updated_at
      properties:
        _id:
          type: string
          description: MongoDB ObjectId
        institution_id:
          type: string
          description: Reference to institution
        name:
          type: string
          description: Program name
          example: "Bachelor of Science in Computer Science"
        program_code:
          type: string
          description: Unique identifier
          example: "BSC-CS"
        description:
          type: string
          description: Program overview
        level:
          type: string
          description: Academic level
          enum:
            [Certificate, Diploma, Bachelor, Master, Doctorate, Postgraduate]
          example: "Bachelor"
        duration:
          type: object
          description: Duration details
          properties:
            value:
              type: number
            unit:
              type: string
              enum: [months, years]
          additionalProperties: true
        delivery_mode:
          type: array
          items:
            type: string
            enum: [On-campus, Online, Hybrid, Distance]
          description: Delivery modes
        fees:
          type: object
          description: Fee structure
          additionalProperties: true
        eligibility:
          type: object
          description: Admission requirements
          additionalProperties: true
        curriculum_summary:
          type: string
          description: Curriculum overview
        specializations:
          type: array
          items:
            type: string
          description: Available specializations
        url:
          type: string
          format: uri
          description: Program or institution URL
        extensions:
          type: object
          description: Additional custom data
          additionalProperties: true
        confidence_score:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0
          description: Confidence score (0-1)
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    ProgramCreate:
      type: object
      required:
        - institution_id
        - name
        - confidence_score
      properties:
        institution_id:
          type: string
        name:
          type: string
        program_code:
          type: string
        description:
          type: string
        level:
          type: string
        duration:
          type: object
          additionalProperties: true
        delivery_mode:
          type: array
          items:
            type: string
        fees:
          type: object
          additionalProperties: true
        eligibility:
          type: object
          additionalProperties: true
        curriculum_summary:
          type: string
        specializations:
          type: array
          items:
            type: string
        url:
          type: string
          format: uri
        extensions:
          type: object
          additionalProperties: true
        confidence_score:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0

    ProgramUpdate:
      type: object
      required:
        - institution_id
        - name
        - confidence_score
      properties:
        institution_id:
          type: string
        name:
          type: string
        program_code:
          type: string
        description:
          type: string
        level:
          type: string
        duration:
          type: object
          additionalProperties: true
        delivery_mode:
          type: array
          items:
            type: string
        fees:
          type: object
          additionalProperties: true
        eligibility:
          type: object
          additionalProperties: true
        curriculum_summary:
          type: string
        specializations:
          type: array
          items:
            type: string
        url:
          type: string
          format: uri
        extensions:
          type: object
          additionalProperties: true
        confidence_score:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0

    ProgramPatch:
      type: object
      properties:
        institution_id:
          type: string
        name:
          type: string
        program_code:
          type: string
        description:
          type: string
        level:
          type: string
        duration:
          type: object
          additionalProperties: true
        delivery_mode:
          type: array
          items:
            type: string
        fees:
          type: object
          additionalProperties: true
        eligibility:
          type: object
          additionalProperties: true
        curriculum_summary:
          type: string
        specializations:
          type: array
          items:
            type: string
        url:
          type: string
          format: uri
        extensions:
          type: object
          additionalProperties: true
        confidence_score:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0

    Pagination:
      type: object
      properties:
        page:
          type: integer
          example: 1
        limit:
          type: integer
          example: 20
        total:
          type: integer
          example: 150
        total_pages:
          type: integer
          example: 8

    Error:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          example: "BAD_REQUEST"
        message:
          type: string
          example: "Invalid request parameters"
        details:
          type: object
          additionalProperties: true

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

    Conflict:
      description: Conflict - resource already exists
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

security:
  - BearerAuth: []
